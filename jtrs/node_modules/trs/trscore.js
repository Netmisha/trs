var os = require('os');
var sleep = require('sleep');
var fileSystem = require("fs");
function Sleep(miliseconds) {
	sleep.usleep(miliseconds*1000);
}
function Messages(suite, test){
	this.suite=suite;
	this.test=test;
	this.sleepTime=500;
}
Messages.prototype.ResultOk = function(process) {
	process.send({suite: this.suite, test: this.test, msg:" OK" });
};
Messages.prototype.Fail = function(process, msg) {
	process.send({suite: this.suite, test: this.test, msg:" Fail: "+msg });
};
Messages.prototype.Error = function(process, msg) {
	process.send({ msg:" Error: "+msg });
};
Messages.prototype.Msg = function(process, msg) {
	process.send({suite: this.suite, test: this.test, msg:this.test+" Msg: "+msg });
};
exports.Messages = Messages;

function Logs (dir) {
	this.dir=dir;
	this.list=[];
	this.file="";
	this.str="";
}
Logs.prototype.Create = function(){
	var date= new Date();
    var file='/log_'+String(date.getDate())+'_'+(date.getMonth()+1<10?'0':'')+String(date.getMonth()+1)+'_'+String(date.getFullYear())+'_'+String(date.getHours())+'_'+String(date.getMinutes())+'_'+String(date.getSeconds())+'.log';
    this.list.push(file);
    this.file=this.dir+file;
};
Logs.prototype.SaveToFile = function(){
	fileSystem.writeFileSync(this.file, this.str);
	this.file="";
	this.str="";
};
Logs.prototype.GetList = function(){
	var res="";
	fileSystem.readdirSync(this.dir).forEach(function(file) {
		res+=file+'$';
	});
	return res;
};
Logs.prototype.GetLog = function(file){	
	return fileSystem.readFileSync(this.dir + '/' + file).toString();
};
Logs.prototype.AddLog = function(msg){
	this.str+=msg+'\n';
};
function Manager() {
	if (os.platform()=="win32") {
		var manageapp = require(process.argv[1].slice(-0, -9)+"/lib/Win/ApplicationManagementWin");
		this.manage = new manageapp.ApplicationManagement();
    }
	else {
		console.log("Operating system not supported");
		process.exit();
	}
}
Manager.prototype.Test = function (fun){
	fun(this);
}
Manager.prototype.ResultOk = function (process, msg){
	this.msg.ResultOk(process);
}
Manager.prototype.Fail = function (process, msg){
	this.msg.Fail(process, msg);
}
Manager.prototype.Error = function (process, msg){
	this.msg.Error(process, msg);
}
Manager.prototype.Msg = function (process, msg){
	this.msg.Msg(process, msg);
}
Manager.prototype.SetWindowSize = function (w, h){
	this.kofX=this.GetScreenWidth()/w;
	this.kofY=this.GetScreenHeight()/h;	
}
Manager.prototype.MouseClickAt = function (button, x, y){
	this.manage.SetMousePos(x,y);
	this.manage.MouseClick(button);
	Sleep(500);
}
Manager.prototype.Shortcut = function (command, key){
	Sleep(500);
	this.manage.KeyDown(Number(command));
	this.manage.KeyPress(Number(key));
	this.manage.KeyUp(Number(command));
	Sleep(500);
}
Manager.prototype.SetAppName = function (name){
	this.manage.SetAppName(String(name));
}
Manager.prototype.SetWindowName = function (name){
	this.manage.SetWindowName(String(name));
}
Manager.prototype.StartApp = function (){
	this.manage.StartApp();
	this.manage.isActive();
	Sleep(500);
}
Manager.prototype.CloseApp = function (){
	this.manage.CloseApp();
	Sleep(500);
}
Manager.prototype.WindowMinimize = function (){
	this.manage.WindowMinimize();
	Sleep(500);
}
Manager.prototype.WindowMaximize = function (){
	this.manage.WindowMaximize();
	Sleep(500);
}
Manager.prototype.SetActive = function (){
	this.manage.SetActive();
	Sleep(500);
}
Manager.prototype.WindowRestore = function (){
	this.manage.WindowRestore();
	Sleep(500);
}
Manager.prototype.GetScreenWidth = function (){
	return this.manage.GetScreenWidth();
}
Manager.prototype.GetScreenHeight = function (){
	return this.manage.GetScreenHeight();
}
Manager.prototype.KeyDown = function (key){
	this.manage.KeyDown(Number(key));
	Sleep(500);
}
Manager.prototype.KeyUp = function (key){
	this.manage.KeyUp(Number(key));
	Sleep(500);
}
Manager.prototype.KeyPress = function (command, key){
	this.manage.KeyPress(Number(key));
	Sleep(500);
}
Manager.prototype.SetMousePos = function (x, y){
	this.manage.SetMousePos(x,y);
	Sleep(500);
}
Manager.prototype.MouseMove = function (x, y, pause){
	this.manage.MouseMove(x,y, pause);
	Sleep(500);
	this.manage.SetMousePos(x,y);
	Sleep(500);
}
Manager.prototype.MouseDown = function (button){
	this.manage.MouseDown(button);
	Sleep(500);
}
Manager.prototype.MouseUp = function (button){
	this.manage.MouseUp(button);
	Sleep(500);
}
Manager.prototype.MouseClick = function (button){
	this.manage.MouseClick(button);
	Sleep(500);
}
Manager.prototype.MouseWheelDown = function (){
	this.manage.MouseWheelDown();
	Sleep(500);
}
Manager.prototype.MouseWheelUp = function (){
	this.manage.MouseWheelUp();
	Sleep(500);
}
Manager.prototype.MouseWheelLeft = function (){
	this.manage.MouseWheelLeft();
	Sleep(500);
}
Manager.prototype.MouseWheelRight = function (){
	this.manage.MouseWheelRight();
	Sleep(500);
}
Manager.prototype.PrintScreen = function (file){
	this.manage.PrintScreen(file);
	Sleep(500);
}
Manager.prototype.Sleep = function (time){
	Sleep(Number(time));
}
Manager.prototype.PrintScreenA = function (x, y, w, h, file){
	this.manage.PrintScreenA(x, y, w, h, file);
	Sleep(500);
}
Manager.prototype.PrintText = function (text){
	text = text.toUpperCase();
	this.manage.KeyDown(Number(16));
	for(var i=0; i<text.length;i++){
		var key = String(text).charCodeAt(i);
		if(key >= 48 && key <= 90) {
			this.manage.KeyPress(String(text).charCodeAt(i));
		}
	}
	this.manage.KeyPress(49);
	this.manage.KeyUp(Number(16));
	Sleep(500);
}

global.Manager = Manager;
global.Logs = Logs;
global.Sleep = Sleep;